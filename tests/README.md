# Test Suite for Twitter Archive Analyzer

This directory contains test files and mock data for testing the Twitter Archive Analyzer.

## Test Files

### Unit Tests
- **test_core.py**: Core functionality tests for parsing, normalization, and type coercion
- **test_integration.py**: Integration tests simulating the complete webapp workflow
- **test_multiworker.py**: Multi-worker compatibility and large file upload tests

### Mock Data Files

The mock data files simulate real Twitter archive exports and cover various formats and edge cases:

#### Small Test Files (Committed to Repository)

**Regular Tweets (mock_tweets.js)** - ~8KB
- 5 sample tweets in JavaScript format (`.js`)
- Includes tweets with:
  - Hashtags and user mentions
  - URLs and media attachments
  - Reply threads
  - Various engagement metrics (favorites, retweets)
  - Different client sources (Web, iPhone, Android, TweetDeck)

**Deleted Tweets (mock_deleted_tweets.js)** - ~2KB
- 2 sample deleted tweets
- Includes `deleted_at` timestamp field
- Tests handling of deleted content

**Twitter Notes (mock_note_tweets.js)** - ~2KB
- 2 sample Twitter Notes (long-form content)
- Tests `noteTweet` format with:
  - Extended text content
  - ISO 8601 timestamps (`createdAt`, `updatedAt`)
  - Hashtags and mentions

**JSON Format (mock_tweets.json)** - ~2KB
- 2 sample tweets in pure JSON format
- Tests handling of `.json` files without JavaScript wrapper
- Uses same structure as `.js` files

#### Medium Test Files (Generated On-Demand)

**Medium Deleted Tweets File (mock_medium_deleted_tweets.js)** - ~260 KB
- 250 deleted tweets to test multi-worker session storage
- **Not committed** to repository (added to `.gitignore`)
- Automatically generated by tests when needed
- Below Flask's 500KB in-memory limit but large enough to test session sharing
- Tests that deleted-tweet-only files work with gunicorn multi-worker setup
- Can be manually generated: `python tests/generate_medium_test_files.py`

**Medium Note Tweets File (mock_medium_note_tweets.js)** - ~122 KB
- 120 note tweets to test multi-worker session storage
- **Not committed** to repository (added to `.gitignore`)
- Automatically generated by tests when needed
- Below Flask's 500KB in-memory limit but large enough to test session sharing
- Tests that note-tweet-only files work with gunicorn multi-worker setup
- Can be manually generated: `python tests/generate_medium_test_files.py`

#### Large Test File (Generated On-Demand)

**Large Tweets File (mock_large_tweets.js)** - ~1.85 MB
- 5000 tweets to test large file handling
- **Not committed** to repository (too large for git, added to `.gitignore`)
- Automatically generated by tests when needed
- Exceeds Flask's 500KB in-memory form data limit
- Tests disk-based file handling in production scenarios
- Can be manually generated: `python tests/generate_large_test_file.py`

## Utility Scripts

- **generate_large_test_file.py**: Generates `mock_large_tweets.js` for testing large file uploads (> 500KB)
- **generate_medium_test_files.py**: Generates medium-sized deleted tweets and note tweets files for multi-worker testing

## Date Formats

The mock data includes both date formats used by Twitter:

1. **RFC 2822 format** (in `tweet.created_at`):
   ```
   "Wed Nov 15 12:00:45 +0000 2023"
   ```

2. **ISO 8601 format** (in `noteTweet.createdAt` and `deleted_at`):
   ```
   "2023-11-15T12:30:45.000Z"
   ```

This ensures the datetime parsing fix handles both formats correctly.

## Running Tests

### Run all unit tests:
```bash
python tests/test_core.py
```

### Run integration tests:
```bash
python tests/test_integration.py
```

### Run multi-worker and large file tests:
```bash
python tests/test_multiworker.py  # Automatically generates test files if needed
```

### Run all test suites:
```bash
python tests/test_core.py && python tests/test_integration.py && python tests/test_multiworker.py
```

## Expected Results

All tests should pass with:
- No UserWarning about datetime format inference
- 100% date parsing success rate
- All record types properly identified (tweet, deleted_tweet, note)
- No empty DataFrames
- Multi-worker session sharing works correctly
- Large file uploads (> 500KB) handled successfully
- Medium file uploads (deleted tweets, note tweets) work with multi-worker setup

## Test Coverage

The test suite validates:
- ✓ Parsing `.js` files with JavaScript wrapper
- ✓ Parsing `.json` files without wrapper
- ✓ Handling deleted tweets with `deleted_at` field
- ✓ Handling Twitter Notes with ISO 8601 dates
- ✓ Date parsing for RFC 2822 format (Twitter API format)
- ✓ Date parsing for ISO 8601 format (Notes format)
- ✓ Data normalization to unified schema
- ✓ Type coercion (datetime, numeric, string)
- ✓ Summary generation
- ✓ Multi-file processing
- ✓ Webapp upload workflow
- ✓ Error handling
- ✓ Multi-worker session sharing (file-based storage)
- ✓ Large file uploads (> 500KB exceeding in-memory limit)
- ✓ Medium file uploads (deleted tweets only, note tweets only)
- ✓ Multi-worker session sharing with all file types
- ✓ Single worker deployment (`python webapp.py`)
- ✓ Gunicorn single worker deployment
- ✓ Gunicorn multi-worker deployment (2+ workers)

